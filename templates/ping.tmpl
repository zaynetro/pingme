<!doctype html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8" />
	<title>Ping me</title>
    <link rel="stylesheet" type="text/css" href="/static/style/template.css" />
</head>
<body>
    <div class="wrapper">
        <nav>
            <a href="/">Create</a>
            <a href="/#about">About</a>
        </nav>
        <main role="main">
            <h1>Ping {{.Room}}</h1>

            {{if .IsHost}}
            <h2>Log:</h2>
            <textarea id="log" readonly></textarea>
            {{else}}
            <h2>{{.Room}} is notified!</h2>
            {{end}}
        </main>
        <footer>
            Made by <a href="//zaynetro.github.io">zaynetro</a> 2015
        </footer>
    </div>

    {{if .IsHost}}
    <script>
    ;(function (window, document, undefined) {
        var host = window.location.host;
        var protocol = (
            window.location.protocol === 'https' 
                ? 'wss'
                : 'ws'
        );

        var url = protocol + '://' + host + '/ws';
        var c = new window.WebSocket(url);

        var logEl = document.querySelector('#log');

        c.onmessage = function (data) {
            log(data.data);
        };

        c.onopen = function () {
            log('Connection opened');
        };

        c.onclose = function () {
            log('Connection closed');
        };

        function log(text) {
            logEl.value = (new Date()).toLocaleString() + ': "' + text + '"\n' + logEl.value;
            console.log(text);
        }
    })(window, document, undefined);
    </script>
    {{end}}
</body>
</html>
